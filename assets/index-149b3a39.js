import{s as ke,g as X,e as x,t as w,i as xe,j as we,k as Re,l as v,n as W,_ as f,f as K,o as P}from"./hub-fed16a30.js";import{s as Kt}from"./hub-fed16a30.js";import{B as Pe,l as u,b as de,d as O,P as Ce,T as Me,D as Y,e as z,a as $e,G as Le,x as ue,F as le,s as He,U as Fe}from"./misc-040bd48c.js";function D(t,e){return t??e()}function je(t,e={}){const n=t.method&&t.method.toUpperCase();let i="",a="url";e.customRoute||t.route?(i=e.customRoute||`${t.baseUrl||""}${t.route&&t.route.path}`,a="route"):(t.originalUrl||t.url)&&(i=ke(t.originalUrl||t.url||""));let r="";return e.method&&n&&(r+=n),e.method&&e.path&&(r+=" "),e.path&&i&&(r+=i),[r,a]}const ze=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function qe(t){const e=t.match(ze);if(!t||!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}const ne="baggage",Ne="sentry-",We=/^sentry-/,Ve=8192;function Je(t){if(!Pe(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce((i,a)=>{const r=pe(a);return{...i,...r}},{});else{if(!t)return;e=pe(t)}const n=Object.entries(e).reduce((i,[a,r])=>{if(a.match(We)){const s=a.slice(Ne.length);i[s]=r}return i},{});if(Object.keys(n).length>0)return n}function be(t){const e=Object.entries(t).reduce((n,[i,a])=>(a&&(n[`${Ne}${i}`]=a),n),{});return Xe(e)}function pe(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,i])=>(e[n]=i,e),{})}function Xe(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,i],a)=>{const r=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`,s=a===0?r:`${e},${r}`;return s.length>Ve?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`Not adding key: ${n} with val: ${i} to baggage header due to exceeding baggage size limits.`),e):s},"")}function ae(t){const e=X().getClient(),n=t||e&&e.getOptions();return!!n&&("tracesSampleRate"in n||"tracesSampler"in n)}function q(t){const n=(t||X()).getScope();return n&&n.getTransaction()}function E(t){return t/1e3}function Ke(){x("error",fe),x("unhandledrejection",fe)}function fe(){const t=q();if(t){const e="internal_error";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}class Q{__init(){this.spans=[]}constructor(e=1e3){Q.prototype.__init.call(this),this._maxlen=e}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}}class N{__init2(){this.traceId=de()}__init3(){this.spanId=de().substring(16)}__init4(){this.startTimestamp=w()}__init5(){this.tags={}}__init6(){this.data={}}__init7(){this.instrumenter="sentry"}constructor(e){if(N.prototype.__init2.call(this),N.prototype.__init3.call(this),N.prototype.__init4.call(this),N.prototype.__init5.call(this),N.prototype.__init6.call(this),N.prototype.__init7.call(this),!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp),e.instrumenter&&(this.instrumenter=e.instrumenter)}startChild(e){const n=new N({...e,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n),n.transaction=this.transaction,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&n.transaction){const i=e&&e.op||"< unknown op >",a=n.transaction.name||"< unknown name >",r=n.transaction.spanId,s=`[Tracing] Starting '${i}' span on transaction '${a}' (${r}).`;n.transaction.metadata.spanMetadata[n.spanId]={logMessage:s},u.log(s)}return n}setTag(e,n){return this.tags={...this.tags,[e]:n},this}setData(e,n){return this.data={...this.data,[e]:n},this}setStatus(e){return this.status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e));const n=Qe(e);return n!=="unknown_error"&&this.setStatus(n),this}isSuccess(){return this.status==="ok"}finish(e){if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:n}=this.transaction.metadata.spanMetadata[this.spanId];n&&u.log(n.replace("Starting","Finishing"))}this.endTimestamp=typeof e=="number"?e:w()}toTraceparent(){let e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${e}`}toContext(){return O({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(e){return this.data=D(e.data,()=>({})),this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=D(e.spanId,()=>this.spanId),this.startTimestamp=D(e.startTimestamp,()=>this.startTimestamp),this.status=e.status,this.tags=D(e.tags,()=>({})),this.traceId=D(e.traceId,()=>this.traceId),this}getTraceContext(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}}function Qe(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}class I extends N{__init(){this._measurements={}}__init2(){this._contexts={}}__init3(){this._frozenDynamicSamplingContext=void 0}constructor(e,n){super(e),I.prototype.__init.call(this),I.prototype.__init2.call(this),I.prototype.__init3.call(this),this._hub=n||X(),this._name=e.name||"",this.metadata={source:"custom",...e.metadata,spanMetadata:{},changes:[],propagations:0},this._trimEnd=e.trimEnd,this.transaction=this;const i=this.metadata.dynamicSamplingContext;i&&(this._frozenDynamicSamplingContext={...i})}get name(){return this._name}set name(e){this.setName(e)}setName(e,n="custom"){(e!==this.name||n!==this.metadata.source)&&this.metadata.changes.push({source:this.metadata.source,timestamp:xe(),propagations:this.metadata.propagations}),this._name=e,this.metadata.source=n}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new Q(e)),this.spanRecorder.add(this)}setContext(e,n){n===null?delete this._contexts[e]:this._contexts[e]=n}setMeasurement(e,n,i=""){this._measurements[e]={value:n,unit:i}}setMetadata(e){this.metadata={...this.metadata,...e}}finish(e){if(this.endTimestamp!==void 0)return;if(this.name||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(e),this.sampled!==!0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");const s=this._hub.getClient();s&&s.recordDroppedEvent("sample_rate","transaction");return}const n=this.spanRecorder?this.spanRecorder.spans.filter(s=>s!==this&&s.endTimestamp):[];this._trimEnd&&n.length>0&&(this.endTimestamp=n.reduce((s,o)=>s.endTimestamp&&o.endTimestamp?s.endTimestamp>o.endTimestamp?s:o:s).endTimestamp);const i=this.metadata,a={contexts:{...this._contexts,trace:this.getTraceContext()},spans:n,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...i,dynamicSamplingContext:this.getDynamicSamplingContext()},...i.source&&{transaction_info:{source:i.source,changes:i.changes,propagations:i.propagations}}};return Object.keys(this._measurements).length>0&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),a.measurements=this._measurements),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(a)}toContext(){const e=super.toContext();return O({...e,name:this.name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this.name=D(e.name,()=>""),this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const e=this._hub||X(),n=e&&e.getClient();if(!n)return{};const{environment:i,release:a}=n.getOptions()||{},{publicKey:r}=n.getDsn()||{},s=this.metadata.sampleRate,o=s!==void 0?s.toString():void 0,c=e.getScope(),{segment:l}=c&&c.getUser()||{},d=this.metadata.source,_=d&&d!=="url"?this.name:void 0;return O({environment:i,release:a,transaction:_,user_segment:l,public_key:r,trace_id:this.traceId,sample_rate:o})}}const De=1e3,Be=3e4,Ue=5e3;class Ze extends Q{constructor(e,n,i,a){super(a),this._pushActivity=e,this._popActivity=n,this.transactionSpanId=i}add(e){e.spanId!==this.transactionSpanId&&(e.finish=n=>{e.endTimestamp=typeof n=="number"?n:w(),this._popActivity(e.spanId)},e.endTimestamp===void 0&&this._pushActivity(e.spanId)),super.add(e)}}class G extends I{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._beforeFinishCallbacks=[]}constructor(e,n,i=De,a=Be,r=Ue,s=!1){super(e,n),this._idleHub=n,this._idleTimeout=i,this._finalTimeout=a,this._heartbeatInterval=r,this._onScope=s,G.prototype.__init.call(this),G.prototype.__init2.call(this),G.prototype.__init3.call(this),G.prototype.__init4.call(this),s&&(he(n),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),n.configureScope(o=>o.setSpan(this))),this._startIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this.finish())},this._finalTimeout)}finish(e=w()){if(this._finished=!0,this.activities={},this.spanRecorder){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] finishing IdleTransaction",new Date(e*1e3).toISOString(),this.op);for(const n of this._beforeFinishCallbacks)n(this,e);this.spanRecorder.spans=this.spanRecorder.spans.filter(n=>{if(n.spanId===this.spanId)return!0;n.endTimestamp||(n.endTimestamp=e,n.setStatus("cancelled"),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(n,void 0,2)));const i=n.startTimestamp<e;return i||(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(n,void 0,2)),i}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] No active IdleTransaction");return this._onScope&&he(this._idleHub),super.finish(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){const n=a=>{this._finished||this._pushActivity(a)},i=a=>{this._finished||this._popActivity(a)};this.spanRecorder=new Ze(n,i,this.spanId,e),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}_cancelIdleTimeout(){this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0)}_startIdleTimeout(e){this._cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&this.finish(e)},this._idleTimeout)}_pushActivity(e){this._cancelIdleTimeout(),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] popActivity ${e}`),delete this.activities[e],(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){const n=w()+this._idleTimeout/1e3;this._startIdleTimeout(n)}}_beat(){if(this._finished)return;const e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.finish()):this._pingHeartbeat()}_pingHeartbeat(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}}function he(t){const e=t.getScope();e&&e.getTransaction()&&e.setSpan(void 0)}function et(){const t=this.getScope();if(t){const e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function Ge(t,e,n){if(!ae(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let i;return typeof e.tracesSampler=="function"?(i=e.tracesSampler(n),t.setMetadata({sampleRate:Number(i)})):n.parentSampled!==void 0?i=n.parentSampled:(i=e.tracesSampleRate,t.setMetadata({sampleRate:Number(i)})),tt(i)?i?(t.sampled=Math.random()<i,t.sampled?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),t)):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function tt(t){return Ce(t)||!(typeof t=="number"||typeof t=="boolean")?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}function nt(t,e){const n=this.getClient(),i=n&&n.getOptions()||{},a=i.instrumenter||"sentry",r=t.instrumenter||"sentry";a!==r&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error(`A transaction was started with instrumenter=\`${r}\`, but the SDK is configured with the \`${a}\` instrumenter.
The transaction will not be sampled. Please use the ${a} instrumentation to start transactions.`),t.sampled=!1);let s=new I(t,this);return s=Ge(s,i,{parentSampled:t.parentSampled,transactionContext:t,...e}),s.sampled&&s.initSpanRecorder(i._experiments&&i._experiments.maxSpans),s}function me(t,e,n,i,a,r,s){const o=t.getClient(),c=o&&o.getOptions()||{};let l=new G(e,t,n,i,s,a);return l=Ge(l,c,{parentSampled:e.parentSampled,transactionContext:e,...r}),l.sampled&&l.initSpanRecorder(c._experiments&&c._experiments.maxSpans),l}function it(){const t=Re();!t.__SENTRY__||(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=nt),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=et))}function st(){const t=Re();if(!t.__SENTRY__)return;const e={mongodb(){const i=W(module,"./integrations/node/mongo");return new i.Mongo},mongoose(){const i=W(module,"./integrations/node/mongo");return new i.Mongo({mongoose:!0})},mysql(){const i=W(module,"./integrations/node/mysql");return new i.Mysql},pg(){const i=W(module,"./integrations/node/postgres");return new i.Postgres}},n=Object.keys(e).filter(i=>!!v(i)).map(i=>{try{return e[i]()}catch{return}}).filter(i=>i);n.length>0&&(t.__SENTRY__.integrations=[...t.__SENTRY__.integrations||[],...n])}function at(){it(),we()&&st(),Ke()}function B(t){const e=f([t,"call",i=>i(),"access",i=>i.getClient,"call",i=>i(),"optionalAccess",i=>i.getOptions,"call",i=>i()]);return(f([e,"optionalAccess",i=>i.instrumenter])||"sentry")!=="sentry"}class C{static __initStatic(){this.id="Express"}__init(){this.name=C.id}constructor(e={}){C.prototype.__init.call(this),this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}setupOnce(e,n){if(!this._router){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("ExpressIntegration is missing an Express instance");return}if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Express Integration is skipped because of instrumenter configuration.");return}ct(this._router,this._methods),_t(this._router)}}C.__initStatic();function ge(t,e){const n=t.length;switch(n){case 2:return function(i,a){const r=a.__sentry_transaction;if(r){const s=r.startChild({description:t.name,op:`middleware.express.${e}`});a.once("finish",()=>{s.finish()})}return t.call(this,i,a)};case 3:return function(i,a,r){const s=a.__sentry_transaction,o=f([s,"optionalAccess",c=>c.startChild,"call",c=>c({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,function(...c){f([o,"optionalAccess",l=>l.finish,"call",l=>l()]),r.call(this,...c)})};case 4:return function(i,a,r,s){const o=r.__sentry_transaction,c=f([o,"optionalAccess",l=>l.startChild,"call",l=>l({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,r,function(...l){f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),s.call(this,...l)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function rt(t,e){return t.map(n=>typeof n=="function"?ge(n,e):Array.isArray(n)?n.map(i=>typeof i=="function"?ge(i,e):i):n)}function ot(t,e){const n=t[e];return t[e]=function(...i){return n.call(this,...rt(i,e))},t}function ct(t,e=[]){e.forEach(n=>ot(t,n))}function _t(t){const e="settings"in t;e&&t._router===void 0&&t.lazyrouter&&t.lazyrouter();const n=e?t._router:t;if(!n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.debug("Routing instrumentation is currently only supported in Express 4.");return}const i=Object.getPrototypeOf(n),a=i.process_params;i.process_params=function(s,o,c,l,d){c._reconstructedRoute||(c._reconstructedRoute="");const{layerRoutePath:_,isRegex:h,isArray:p,numExtraSegments:m}=dt(s);(_||h||p)&&(c._hasParameters=!0);const b=(_||s.path||"").split("/").filter(U=>U.length>0&&(h||p||!U.includes("*"))).join("/");b&&b.length>0&&(c._reconstructedRoute+=`/${b}${h?"/":""}`);const R=K(c.originalUrl||"")+m,Ye=K(c._reconstructedRoute);if(R===Ye){c._hasParameters||c._reconstructedRoute!==c.originalUrl&&(c._reconstructedRoute=c.originalUrl);const U=l.__sentry_transaction;if(U&&U.metadata.source!=="custom"){const Oe=c._reconstructedRoute||"/";U.setName(...je(c,{path:!0,method:!0,customRoute:Oe}))}}return a.call(this,s,o,c,l,d)}}function dt(t){const e=f([t,"access",s=>s.route,"optionalAccess",s=>s.path]),n=Me(e),i=Array.isArray(e);if(!e)return{isRegex:n,isArray:i,numExtraSegments:0};const a=i?Math.max(ut(e)-K(t.path||""),0):0;return{layerRoutePath:lt(i,e),isRegex:n,isArray:i,numExtraSegments:a}}function ut(t){return t.reduce((e,n)=>e+K(n.toString()),0)}function lt(t,e){return t?e.map(n=>n.toString()).join(","):e&&e.toString()}class M{static __initStatic(){this.id="Postgres"}__init(){this.name=M.id}constructor(e={}){M.prototype.__init.call(this),this._usePgNative=!!e.usePgNative}setupOnce(e,n){if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Postgres Integration is skipped because of instrumenter configuration.");return}const i=v("pg");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("Postgres Integration was unable to require `pg` package.");return}if(this._usePgNative&&!f([i,"access",r=>r.native,"optionalAccess",r=>r.Client])){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("Postgres Integration was unable to access 'pg-native' bindings.");return}const{Client:a}=this._usePgNative?i.native:i;Y(a.prototype,"query",function(r){return function(s,o,c){const l=n().getScope(),d=f([l,"optionalAccess",p=>p.getSpan,"call",p=>p()]),_=f([d,"optionalAccess",p=>p.startChild,"call",p=>p({description:typeof s=="string"?s:s.text,op:"db"})]);if(typeof c=="function")return r.call(this,s,o,function(p,m){f([_,"optionalAccess",S=>S.finish,"call",S=>S()]),c(p,m)});if(typeof o=="function")return r.call(this,s,function(p,m){f([_,"optionalAccess",S=>S.finish,"call",S=>S()]),o(p,m)});const h=typeof o<"u"?r.call(this,s,o):r.call(this,s);return z(h)?h.then(p=>(f([_,"optionalAccess",m=>m.finish,"call",m=>m()]),p)):(f([_,"optionalAccess",p=>p.finish,"call",p=>p()]),h)}})}}M.__initStatic();class ${constructor(){$.prototype.__init.call(this)}static __initStatic(){this.id="Mysql"}__init(){this.name=$.id}setupOnce(e,n){if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Mysql Integration is skipped because of instrumenter configuration.");return}const i=v("mysql/lib/Connection.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("Mysql Integration was unable to require `mysql` package.");return}Y(i,"createQuery",function(a){return function(r,s,o){const c=n().getScope(),l=f([c,"optionalAccess",_=>_.getSpan,"call",_=>_()]),d=f([l,"optionalAccess",_=>_.startChild,"call",_=>_({description:typeof r=="string"?r:r.sql,op:"db"})]);return typeof o=="function"?a.call(this,r,s,function(_,h,p){f([d,"optionalAccess",m=>m.finish,"call",m=>m()]),o(_,h,p)}):typeof s=="function"?a.call(this,r,function(_,h,p){f([d,"optionalAccess",m=>m.finish,"call",m=>m()]),s(_,h,p)}):a.call(this,r,s,o)}})}}$.__initStatic();const pt=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],ft={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function ht(t){return t&&typeof t=="object"&&t.once&&typeof t.once=="function"}class L{static __initStatic(){this.id="Mongo"}__init(){this.name=L.id}constructor(e={}){L.prototype.__init.call(this),this._operations=Array.isArray(e.operations)?e.operations:pt,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}setupOnce(e,n){if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Mongo Integration is skipped because of instrumenter configuration.");return}const i=this._useMongoose?"mongoose":"mongodb",a=v(i);if(!a){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error(`Mongo Integration was unable to require \`${i}\` package.`);return}this._instrumentOperations(a.Collection,this._operations,n)}_instrumentOperations(e,n,i){n.forEach(a=>this._patchOperation(e,a,i))}_patchOperation(e,n,i){if(!(n in e.prototype))return;const a=this._getSpanContextFromOperationArguments.bind(this);Y(e.prototype,n,function(r){return function(...s){const o=s[s.length-1],c=i().getScope(),l=f([c,"optionalAccess",_=>_.getSpan,"call",_=>_()]);if(typeof o!="function"||n==="mapReduce"&&s.length===2){const _=f([l,"optionalAccess",p=>p.startChild,"call",p=>p(a(this,n,s))]),h=r.call(this,...s);if(z(h))return h.then(p=>(f([_,"optionalAccess",m=>m.finish,"call",m=>m()]),p));if(ht(h)){const p=h;try{p.once("close",()=>{f([_,"optionalAccess",m=>m.finish,"call",m=>m()])})}catch{f([_,"optionalAccess",S=>S.finish,"call",S=>S()])}return p}else return f([_,"optionalAccess",p=>p.finish,"call",p=>p()]),h}const d=f([l,"optionalAccess",_=>_.startChild,"call",_=>_(a(this,n,s.slice(0,-1)))]);return r.call(this,...s.slice(0,-1),function(_,h){f([d,"optionalAccess",p=>p.finish,"call",p=>p()]),o(_,h)})}})}_getSpanContextFromOperationArguments(e,n,i){const a={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},r={op:"db",description:n,data:a},s=ft[n],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!s||!o)return r;try{if(n==="mapReduce"){const[c,l]=i;a[s[0]]=typeof c=="string"?c:c.name||"<anonymous>",a[s[1]]=typeof l=="string"?l:l.name||"<anonymous>"}else for(let c=0;c<s.length;c++)a[s[c]]=JSON.stringify(i[c])}catch{}return r}}L.__initStatic();function mt(t){return t&&!!t.$use}class H{static __initStatic(){this.id="Prisma"}__init(){this.name=H.id}constructor(e={}){H.prototype.__init.call(this),mt(e.client)?this._client=e.client:(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`Unsupported Prisma client provided to PrismaIntegration. Provided client: ${JSON.stringify(e.client)}`)}setupOnce(e,n){if(!this._client){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("PrismaIntegration is missing a Prisma Client Instance");return}if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Prisma Integration is skipped because of instrumenter configuration.");return}this._client.$use((i,a)=>{const r=n().getScope(),s=f([r,"optionalAccess",_=>_.getSpan,"call",_=>_()]),o=i.action,c=i.model,l=f([s,"optionalAccess",_=>_.startChild,"call",_=>_({description:c?`${c} ${o}`:o,op:"db.sql.prisma"})]),d=a(i);return z(d)?d.then(_=>(f([l,"optionalAccess",h=>h.finish,"call",h=>h()]),_)):(f([l,"optionalAccess",_=>_.finish,"call",_=>_()]),d)})}}H.__initStatic();class F{constructor(){F.prototype.__init.call(this)}static __initStatic(){this.id="GraphQL"}__init(){this.name=F.id}setupOnce(e,n){if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("GraphQL Integration is skipped because of instrumenter configuration.");return}const i=v("graphql/execution/execute.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("GraphQL Integration was unable to require graphql/execution package.");return}Y(i,"execute",function(a){return function(...r){const s=n().getScope(),o=f([s,"optionalAccess",d=>d.getSpan,"call",d=>d()]),c=f([o,"optionalAccess",d=>d.startChild,"call",d=>d({description:"execute",op:"graphql.execute"})]);f([s,"optionalAccess",d=>d.setSpan,"call",d=>d(c)]);const l=a.call(this,...r);return z(l)?l.then(d=>(f([c,"optionalAccess",_=>_.finish,"call",_=>_()]),f([s,"optionalAccess",_=>_.setSpan,"call",_=>_(o)]),d)):(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),f([s,"optionalAccess",d=>d.setSpan,"call",d=>d(o)]),l)}})}}F.__initStatic();class j{constructor(){j.prototype.__init.call(this)}static __initStatic(){this.id="Apollo"}__init(){this.name=j.id}setupOnce(e,n){if(B(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("Apollo Integration is skipped because of instrumenter configuration.");return}const i=v("apollo-server-core");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.error("Apollo Integration was unable to require apollo-server-core package.");return}Y(i.ApolloServerBase.prototype,"constructSchema",function(a){return function(){if(!this.config.resolvers)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(this.config.schema?u.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property."):this.config.modules&&u.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),u.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),a.call(this);const r=$e(this.config.resolvers);return this.config.resolvers=r.map(s=>(Object.keys(s).forEach(o=>{Object.keys(s[o]).forEach(c=>{typeof s[o][c]=="function"&&gt(s,o,c,n)})}),s)),a.call(this)}})}}j.__initStatic();function gt(t,e,n,i){Y(t[e],n,function(a){return function(...r){const s=i().getScope(),o=f([s,"optionalAccess",d=>d.getSpan,"call",d=>d()]),c=f([o,"optionalAccess",d=>d.startChild,"call",d=>d({description:`${e}.${n}`,op:"graphql.resolve"})]),l=a.call(this,...r);return z(l)?l.then(d=>(f([c,"optionalAccess",_=>_.finish,"call",_=>_()]),d)):(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),l)}})}const g=Le;function Tt(){g&&g.document?g.document.addEventListener("visibilitychange",()=>{const t=q();if(g.document.hidden&&t){const e="cancelled";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}}):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const re=(t,e,n)=>{let i,a;return r=>{e.value>=0&&(r||n)&&(a=e.value-(i||0),(a||i===void 0)&&(i=e.value,e.delta=a,t(e)))}},Et=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,St=()=>{const t=g.performance.timing,e=g.performance.navigation.type,n={entryType:"navigation",startTime:0,type:e==2?"back_forward":e===1?"reload":"navigate"};for(const i in t)i!=="navigationStart"&&i!=="toJSON"&&(n[i]=Math.max(t[i]-t.navigationStart,0));return n},Ie=()=>g.__WEB_VITALS_POLYFILL__?g.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||St()):g.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],Ae=()=>{const t=Ie();return t&&t.activationStart||0},oe=(t,e)=>{const n=Ie();let i="navigate";return n&&(g.document.prerendering||Ae()>0?i="prerender":i=n.type.replace(/_/g,"-")),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:Et(),navigationType:i}},Z=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const i=new PerformanceObserver(a=>{e(a.getEntries())});return i.observe(Object.assign({type:t,buffered:!0},n||{})),i}}catch{}},ee=(t,e)=>{const n=i=>{(i.type==="pagehide"||g.document.visibilityState==="hidden")&&(t(i),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},yt=t=>{const e=oe("CLS",0);let n,i=0,a=[];const r=o=>{o.forEach(c=>{if(!c.hadRecentInput){const l=a[0],d=a[a.length-1];i&&a.length!==0&&c.startTime-d.startTime<1e3&&c.startTime-l.startTime<5e3?(i+=c.value,a.push(c)):(i=c.value,a=[c]),i>e.value&&(e.value=i,e.entries=a,n&&n())}})},s=Z("layout-shift",r);s&&(n=re(t,e),ee(()=>{r(s.takeRecords()),n(!0)}))};let J=-1;const Rt=()=>g.document.visibilityState==="hidden"&&!g.document.prerendering?0:1/0,Nt=()=>{ee(({timeStamp:t})=>{J=t},!0)},ce=()=>(J<0&&(J=Rt(),Nt()),{get firstHiddenTime(){return J}}),bt=t=>{const e=ce(),n=oe("FID");let i;const a=o=>{o.startTime<e.firstHiddenTime&&(n.value=o.processingStart-o.startTime,n.entries.push(o),i(!0))},r=o=>{o.forEach(a)},s=Z("first-input",r);i=re(t,n),s&&ee(()=>{r(s.takeRecords()),s.disconnect()},!0)},Te={},Dt=t=>{const e=ce(),n=oe("LCP");let i;const a=s=>{const o=s[s.length-1];if(o){const c=Math.max(o.startTime-Ae(),0);c<e.firstHiddenTime&&(n.value=c,n.entries=[o],i())}},r=Z("largest-contentful-paint",a);if(r){i=re(t,n);const s=()=>{Te[n.id]||(a(r.takeRecords()),r.disconnect(),Te[n.id]=!0,i(!0))};["keydown","click"].forEach(o=>{addEventListener(o,s,{once:!0,capture:!0})}),ee(s,!0)}};function te(t){return typeof t=="number"&&isFinite(t)}function A(t,{startTimestamp:e,...n}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...n})}function ve(){return g&&g.addEventListener&&g.performance}let Ee=0,T={},y,k;function Bt(){const t=ve();t&&P&&(t.mark&&g.performance.mark("sentry-tracing-init"),Gt(),It(),At())}function Ut(){Z("longtask",e=>{for(const n of e){const i=q();if(!i)return;const a=E(P+n.startTime),r=E(n.duration);i.startChild({description:"Main UI thread blocked",op:"ui.long-task",startTimestamp:a,endTimestamp:a+r})}})}function Gt(){yt(t=>{const e=t.entries.pop();!e||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding CLS"),T.cls={value:t.value,unit:""},k=e)})}function It(){Dt(t=>{const e=t.entries.pop();!e||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding LCP"),T.lcp={value:t.value,unit:"millisecond"},y=e)})}function At(){bt(t=>{const e=t.entries.pop();if(!e)return;const n=E(P),i=E(e.startTime);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding FID"),T.fid={value:t.value,unit:"millisecond"},T["mark.fid"]={value:n+i,unit:"second"}})}function vt(t){const e=ve();if(!e||!g.performance.getEntries||!P)return;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Tracing] Adding & adjusting spans using Performance API");const n=E(P),i=e.getEntries();let a,r;if(i.slice(Ee).forEach(s=>{const o=E(s.startTime),c=E(s.duration);if(!(t.op==="navigation"&&n+o<t.startTimestamp))switch(s.entryType){case"navigation":{Ot(t,s,n),a=n+E(s.responseStart),r=n+E(s.requestStart);break}case"mark":case"paint":case"measure":{Yt(t,s,o,c,n);const l=ce(),d=s.startTime<l.firstHiddenTime;s.name==="first-paint"&&d&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding FP"),T.fp={value:s.startTime,unit:"millisecond"}),s.name==="first-contentful-paint"&&d&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding FCP"),T.fcp={value:s.startTime,unit:"millisecond"});break}case"resource":{const l=s.name.replace(g.location.origin,"");xt(t,s,l,o,c,n);break}}}),Ee=Math.max(i.length-1,0),wt(t),t.op==="pageload"){typeof a=="number"&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding TTFB"),T.ttfb={value:(a-t.startTimestamp)*1e3,unit:"millisecond"},typeof r=="number"&&r<=a&&(T["ttfb.requestTime"]={value:(a-r)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(o=>{if(!T[o]||n>=t.startTimestamp)return;const c=T[o].value,l=n+E(c),d=Math.abs((l-t.startTimestamp)*1e3),_=d-c;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Measurements] Normalized ${o} from ${c} to ${d} (${_})`),T[o].value=d});const s=T["mark.fid"];s&&T.fid&&(A(t,{description:"first input delay",endTimestamp:s.value+E(T.fid.value),op:"ui.action",startTimestamp:s.value}),delete T["mark.fid"]),"fcp"in T||delete T.cls,Object.keys(T).forEach(o=>{t.setMeasurement(o,T[o].value,T[o].unit)}),Pt(t)}y=void 0,k=void 0,T={}}function Yt(t,e,n,i,a){const r=a+n,s=r+i;return A(t,{description:e.name,endTimestamp:s,op:e.entryType,startTimestamp:r}),r}function Ot(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(i=>{V(t,e,i,n)}),V(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),V(t,e,"fetch",n,"cache","domainLookupStart"),V(t,e,"domainLookup",n,"DNS"),kt(t,e,n)}function V(t,e,n,i,a,r){const s=r?e[r]:e[`${n}End`],o=e[`${n}Start`];!o||!s||A(t,{op:"browser",description:D(a,()=>n),startTimestamp:i+E(o),endTimestamp:i+E(s)})}function kt(t,e,n){A(t,{op:"browser",description:"request",startTimestamp:n+E(e.requestStart),endTimestamp:n+E(e.responseEnd)}),A(t,{op:"browser",description:"response",startTimestamp:n+E(e.responseStart),endTimestamp:n+E(e.responseEnd)})}function xt(t,e,n,i,a,r){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const s={};"transferSize"in e&&(s["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(s["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(s["Decoded Body Size"]=e.decodedBodySize);const o=r+i,c=o+a;A(t,{description:n,endTimestamp:c,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",startTimestamp:o,data:s})}function wt(t){const e=g.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setTag("effectiveConnectionType",n.effectiveType),n.type&&t.setTag("connectionType",n.type),te(n.rtt)&&(T["connection.rtt"]={value:n.rtt,unit:"millisecond"})),te(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),te(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}function Pt(t){y&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding LCP Data"),y.element&&t.setTag("lcp.element",ue(y.element)),y.id&&t.setTag("lcp.id",y.id),y.url&&t.setTag("lcp.url",y.url.trim().slice(0,200)),t.setTag("lcp.size",y.size)),k&&k.sources&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log("[Measurements] Adding CLS Data"),k.sources.forEach((e,n)=>t.setTag(`cls.source.${n+1}`,ue(e.node))))}const ie=["localhost",/^\//],se={traceFetch:!0,traceXHR:!0,tracingOrigins:ie,tracePropagationTargets:ie};function Ct(t){const{traceFetch:e,traceXHR:n,tracePropagationTargets:i,tracingOrigins:a,shouldCreateSpanForRequest:r}={traceFetch:se.traceFetch,traceXHR:se.traceXHR,...t},s=typeof r=="function"?r:l=>!0,o=l=>Mt(l,i||a),c={};e&&x("fetch",l=>{$t(l,s,o,c)}),n&&x("xhr",l=>{Ht(l,s,o,c)})}function Mt(t,e){return He(t,e||ie)}function $t(t,e,n,i){if(!ae()||!(t.fetchData&&e(t.fetchData.url)))return;if(t.endTimestamp){const r=t.fetchData.__span;if(!r)return;const s=i[r];s&&(t.response?s.setHttpStatus(t.response.status):t.error&&s.setStatus("internal_error"),s.finish(),delete i[r]);return}const a=q();if(a){const r=a.startChild({data:{...t.fetchData,type:"fetch"},description:`${t.fetchData.method} ${t.fetchData.url}`,op:"http.client"});t.fetchData.__span=r.spanId,i[r.spanId]=r;const s=t.args[0];t.args[1]=t.args[1]||{};const o=t.args[1];n(t.fetchData.url)&&(o.headers=Lt(s,a.getDynamicSamplingContext(),r,o),a.metadata.propagations++)}}function Lt(t,e,n,i){const a=be(e),r=n.toTraceparent(),s=typeof Request<"u"&&le(t,Request)?t.headers:i.headers;if(s)if(typeof Headers<"u"&&le(s,Headers)){const o=new Headers(s);return o.append("sentry-trace",r),a&&o.append(ne,a),o}else if(Array.isArray(s)){const o=[...s,["sentry-trace",r]];return a&&o.push([ne,a]),o}else{const o="baggage"in s?s.baggage:void 0,c=[];return Array.isArray(o)?c.push(...o):o&&c.push(o),a&&c.push(a),{...s,"sentry-trace":r,baggage:c.length>0?c.join(","):void 0}}else return{"sentry-trace":r,baggage:a}}function Ht(t,e,n,i){if(!ae()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))return;const a=t.xhr.__sentry_xhr__;if(t.endTimestamp){const s=t.xhr.__sentry_xhr_span_id__;if(!s)return;const o=i[s];o&&(o.setHttpStatus(a.status_code),o.finish(),delete i[s]);return}const r=q();if(r){const s=r.startChild({data:{...a.data,type:"xhr",method:a.method,url:a.url},description:`${a.method} ${a.url}`,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=s.spanId,i[t.xhr.__sentry_xhr_span_id__]=s,t.xhr.setRequestHeader&&n(t.xhr.__sentry_xhr__.url))try{t.xhr.setRequestHeader("sentry-trace",s.toTraceparent());const o=r.getDynamicSamplingContext(),c=be(o);c&&t.xhr.setRequestHeader(ne,c),r.metadata.propagations++}catch{}}}function Ft(t,e=!0,n=!0){if(!g||!g.location){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn("Could not initialize routing instrumentation due to invalid location");return}let i=g.location.href,a;e&&(a=t({name:g.location.pathname,op:"pageload",metadata:{source:"url"}})),n&&x("history",({to:r,from:s})=>{if(s===void 0&&i&&i.indexOf(r)!==-1){i=void 0;return}s!==r&&(i=void 0,a&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Finishing current transaction with op: ${a.op}`),a.finish()),a=t({name:g.location.pathname,op:"navigation",metadata:{source:"url"}}))})}const jt="BrowserTracing",zt={idleTimeout:De,finalTimeout:Be,heartbeatInterval:Ue,markBackgroundTransactions:!0,routingInstrumentation:Ft,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,_experiments:{enableLongTask:!0,enableInteractions:!1},...se};class _e{__init(){this.name=jt}constructor(e){_e.prototype.__init.call(this),this.options={...zt,...e},e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins),Bt(),f([this,"access",n=>n.options,"access",n=>n._experiments,"optionalAccess",n=>n.enableLongTask])&&Ut()}setupOnce(e,n){this._getCurrentHub=n;const{routingInstrumentation:i,startTransactionOnLocationChange:a,startTransactionOnPageLoad:r,markBackgroundTransactions:s,traceFetch:o,traceXHR:c,tracePropagationTargets:l,shouldCreateSpanForRequest:d,_experiments:_}=this.options;i(h=>this._createRouteTransaction(h),r,a),s&&Tt(),f([_,"optionalAccess",h=>h.enableInteractions])&&this._registerInteractionListener(),Ct({traceFetch:o,traceXHR:c,tracePropagationTargets:l,shouldCreateSpanForRequest:d})}_createRouteTransaction(e){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}const{beforeNavigate:n,idleTimeout:i,finalTimeout:a,heartbeatInterval:r}=this.options,s=e.op==="pageload",o=s?Se("sentry-trace"):null,c=s?Se("baggage"):null,l=o?qe(o):void 0,d=c?Je(c):void 0,_={...e,...l,metadata:{...e.metadata,dynamicSamplingContext:l&&!d?{}:d},trimEnd:!0},h=typeof n=="function"?n(_):_,p=h===void 0?{..._,sampled:!1}:h;p.metadata=p.name!==_.name?{...p.metadata,source:"custom"}:p.metadata,this._latestRouteName=p.name,this._latestRouteSource=f([p,"access",R=>R.metadata,"optionalAccess",R=>R.source]),p.sampled===!1&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Will not send ${p.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.log(`[Tracing] Starting ${p.op} transaction on scope`);const m=this._getCurrentHub(),{location:S}=g,b=me(m,p,i,a,!0,{location:S},r);return b.registerBeforeFinishCallback(R=>{vt(R)}),b}_registerInteractionListener(){let e;const n=()=>{const{idleTimeout:i,finalTimeout:a,heartbeatInterval:r}=this.options,s="ui.action.click";if(e&&(e.finish(),e=void 0),!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`[Tracing] Did not create ${s} transaction because _getCurrentHub is invalid.`);return}if(!this._latestRouteName){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&u.warn(`[Tracing] Did not create ${s} transaction because _latestRouteName is missing.`);return}const o=this._getCurrentHub(),{location:c}=g,l={name:this._latestRouteName,op:s,trimEnd:!0,metadata:{source:D(this._latestRouteSource,()=>"url")}};e=me(o,l,i,a,!0,{location:c},r)};["click"].forEach(i=>{addEventListener(i,n,{once:!1,capture:!0})})}}function Se(t){const e=Fe(`meta[name=${t}]`);return e?e.getAttribute("content"):null}const Vt=Object.freeze(Object.defineProperty({__proto__:null,Express:C,Postgres:M,Mysql:$,Mongo:L,Prisma:H,GraphQL:F,Apollo:j,BrowserTracing:_e},Symbol.toStringTag,{value:"Module"}));var ye;(function(t){const e="ok";t.Ok=e;const n="deadline_exceeded";t.DeadlineExceeded=n;const i="unauthenticated";t.Unauthenticated=i;const a="permission_denied";t.PermissionDenied=a;const r="not_found";t.NotFound=r;const s="resource_exhausted";t.ResourceExhausted=s;const o="invalid_argument";t.InvalidArgument=o;const c="unimplemented";t.Unimplemented=c;const l="unavailable";t.Unavailable=l;const d="internal_error";t.InternalError=d;const _="unknown_error";t.UnknownError=_;const h="cancelled";t.Cancelled=h;const p="already_exists";t.AlreadyExists=p;const m="failed_precondition";t.FailedPrecondition=m;const S="aborted";t.Aborted=S;const b="out_of_range";t.OutOfRange=b;const R="data_loss";t.DataLoss=R})(ye||(ye={}));(typeof __SENTRY_TRACING__>"u"||__SENTRY_TRACING__)&&at();export{jt as BROWSER_TRACING_INTEGRATION_ID,_e as BrowserTracing,G as IdleTransaction,Vt as Integrations,N as Span,ye as SpanStatus,ze as TRACEPARENT_REGEXP,I as Transaction,at as addExtensionMethods,se as defaultRequestInstrumentationOptions,qe as extractTraceparentData,q as getActiveTransaction,ae as hasTracingEnabled,Ct as instrumentOutgoingRequests,Qe as spanStatusfromHttpCode,me as startIdleTransaction,Kt as stripUrlQueryAndFragment};
